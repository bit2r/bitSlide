{
  "hash": "a43aee4ce30bd49921fa3c242c31a1cc",
  "result": {
    "markdown": "---\ntitle: \"기후 위기\"\nsubtitle: \"이산화탄소 증가 추세\"\nformat: \n  html:\n    toc: true\n    echo: false\n    keep-hidden: true\n    code-tools: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n![](fig/interactive-workflow.png)\n\n이산화탄소($CO_2$) 증가에 따라 기후위기가 이제 홍수와 가뭄으로 우리곁에 성큼 다가왔다. 미국 해양대기청(NOAA)에서 하와이 마우나로아(Mauna Loa)산에서 측정한 대기중 이산화탄소 농도 추세를 인터랙티브 시각화해보자.\n\n# 데이터\n\n[Trends in Atmospheric Carbon Dioxide](https://gml.noaa.gov/ccgg/trends/data.html)에서 월별 $CO_2$ 농도 데이터를 NOASS 웹사이트에서 바로 다운로드 받아 가져온다. 이를 ggplot으로 시각화해본다.\n\n\n::: {.cell warning.hidden='true' message.hidden='true'}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──\n```\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\n✔ ggplot2 3.3.6     ✔ purrr   0.3.4\n✔ tibble  3.1.8     ✔ dplyr   1.0.9\n✔ tidyr   1.2.0     ✔ stringr 1.4.1\n✔ readr   2.1.2     ✔ forcats 0.5.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\nWarning: package 'tibble' was built under R version 4.2.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\nWarning: package 'dplyr' was built under R version 4.2.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\nWarning: package 'stringr' was built under R version 4.2.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\nWarning: package 'forcats' was built under R version 4.2.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code .hidden}\n# bitData::global_co2 %>% \n#   write_csv(\"data/co2_year.csv\")\n\nglobal_co2 <- read_csv(\"https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.csv\", skip = 52)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\nRows: 774 Columns: 8\n```\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n```\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (8): year, month, decimal date, average, deseasonalized, ndays, sdev, unc\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code .hidden}\nglobal_co2 %>% \n  janitor::clean_names() %>% \n  mutate(yearmon = lubridate::make_date(year = year, month = month)) %>% \n  ggplot(aes(x=yearmon, y = average)) +\n    geom_line() +\n    geom_line(aes(y= deseasonalized), color = \"red\") +\n    theme_bw() +\n    labs(x = \"년월\",\n         y = \"평균 CO2 농도\",\n         title = \"월별 대기중 CO2 농도 추세\")\n```\n\n::: {.cell-output-display}\n![](climate-crisis_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n인터랙티브 시각화를 위해 데이터를 년도별로 평균을 내어 이를 시각화하는데 사용한다.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nglobal_co2 %>% \n  janitor::clean_names() %>% \n  group_by(year) %>% \n  summarize( mean = mean(average)) %>% \n  write_csv(\"data/co2_year.csv\")\n```\n:::\n\n\n로컬 저장소에 저장한 csv 파일을 이제 Observable JS 로 불러와서 년도를 달리하여 $CO_2$ 농도의 추세를 살펴본다.\n\n\n```{ojs}\nco2_data = FileAttachment(\"../data/co2_year.csv\").csv({ typed: true })\n\nco2_filtered = co2_data.filter(function(co2) {\n  return study_year < co2.year ;\n})\n```\n\n\n# UI\n\n인터랙티브 데이터 시각화를 위해서 UI 입력부분을 정의한다. 먼저 연도를 슬라이더 입력값(`Input.range()`)에 넣어둔다.\n\n\n```{ojs}\n//| panel: input\nviewof study_year = Inputs.range(\n  [1959, 2021], \n  {value: 1980, step: 1, label: \"연도:\"}\n)\n```\n\n\n# 인터랙티브 그래프\n\n인터랙티브 데이터를 선택한 결과를 실시간 데이터와 그래프로 시각화하여 문서에 담아낸다.\n\n::: {.panel-tabset}\n\n## 시각화\n\n\n```{ojs}\nPlot.plot({\n  marks: [\n    Plot.line(co2_filtered, \n      { x: \"year\", y: \"mean\"}, \n      { stroke: \"black\" }\n    )\n  ]\n})\n```\n\n\n## 표\n\n\n```{ojs}\nInputs.table(co2_filtered)\n```\n\n\n:::\n\n\n",
    "supporting": [
      "climate-crisis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}